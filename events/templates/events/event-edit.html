{% extends 'events/base.html' %}

{% block content %}
    {% load staticfiles %}
    <style>
        img {
            max-width: 100% !important;
            display: block;
        }
    </style>
    <body>

    <script>
        tinymce.init({
            selector: '#body',
            plugins: 'image',
            extended_valid_elements: 'img[class|src|border=0|alt|title|width|height]',
            image_description: false,
            image_dimensions: false,
            file_picker_types: 'image',
            content_css: "{% static 'news/css/popup.css' %}",
            file_picker_callback: function (callback, value, meta) {
                var input = document.createElement('input');
                input.setAttribute('type', 'file');
                input.setAttribute('accept', 'image/*');

                input.onchange = function () {
                    var file = this.files[0];
                    var reader = new FileReader();
                    reader.readAsDataURL(file);

                    reader.onload = function () {
                        var id = 'blobid' + (new Date()).getTime();
                        var blobCache = tinymce.activeEditor.editorUpload.blobCache;
                        var base64 = reader.result.split(',')[1];
                        var blobIno = blobCache.create(id, file, base64);
                        blobCache.add(blobInfo);

                        callback(blobInfo.blobUri(), {title: file.name});
                    };
                };
                input.click();
            },
            height: 500
        });

    </script>

    <header id="masthead" class="site-header">

        <div class="top-nav">

            <div class="container container-960">

                <a href="/" class="site-logo" rel="home"><img src="{% static 'news/img/logo.png' %}" alt=""
                                                              srcset="{% static 'news/img/logo.png' %} 1x, {% static 'news/img/logo@2x.png' %} 2x"></a>

                <button class="lines-button x toggle-menu" type="button" id="toggle-menu">
                    <span class="lines line-top"></span>
                    <span class="lines line-middle"></span>
                    <span class="lines line-bottom"></span>
                </button><!-- /.lines-button -->

                <nav id="primary-navigation" class="site-navigation">

                    <a href="index.html" class="site-logo visible-xs" rel="home"><img
                            src="{% static 'news/img/logo.png' %}" alt=""
                            srcset="{% static 'news/img/logo.png' %} 1x, {% static 'news/img/logo@2x.png' %} 2x"></a>

                    <ul>
                        <li><a href="/news">News</a></li>
                        <li><a href="/events" class="active">Events</a></li>
                        <li><a href="/officespace">Officespace</a></li>
                        <!--<li><a href="/c/companies">Companies</a></li>-->
                        <!--<li><a href="/c/people">People</a></li>-->
                        {% for page in navbar_pages %}
                            <li><a href="/news/{{ page.id }}">{{ page.title }}</a></li>
                        {% endfor %}
                    </ul>

                </nav><!-- /.site-navigation -->

                <div class="user-profile dropdown">

                    <a class="dropdown-toggle" id="user-dropdown-menu" data-toggle="dropdown" aria-expanded="true">
                        <div class="user-profile-thumb">

                        {% if request.user.profile.image %}
                            <img src="{{ request.user.profile.image.url }}" alt="">
                        {% else %}
                            <img src="{% static 'community/img/avatar.jpg' %}" alt="">
                        {% endif %}

                        <span
                                class="visible-xs caret"></span></div>
                        <div class="user-profile-meta hidden-xs">
                            <div class="user-profile-meta-inner">
                                {{ request.user.username }}
                            </div>
                        </div>
                    </a>

                    <ul class="dropdown-menu" aria-labelledby="user-dropdown-menu">
                <li><a href="/c/people/{{ request.user.id }}">Profile</a></li>
                <!--<li><a href="#">Settings</a></li>-->
                <li class="logout-btn"><a href="/logout">Logout</a></li>
                    </ul>

                </div><!-- /.user-profile -->

            </div><!-- /.container -->

        </div><!-- /.top-nav -->

        <div class="hero event-details-hero">

            <div class="container">

                <div class="hero-text">
                    {% if dashboard %}
                        <h1 class="hero-title">Publish New Event</h1>
                    {% else %}
                        <p class="event-start-date">From: {{ event.start_date }}</p>
                        <p class="event-end-date">To: {{ event.pub_date }}</p>
                        <h1 class="event.title">{{ event.title }}</h1>
                        <p>posted by <a href="">{{ event.author }}</a></p>
                        <a class="btn btn-transparent-white" href="{{ event.event_url }}">RSVP</a>
                    {% endif %}
                </div>
            </div>
        </div>


    </header><!-- /#header -->


    <div id="main" class="site-main">

        <section class="event-details-content">

            <div class="container container-960">

                <div class="row">
                    <form method="post">
                        {% csrf_token %}
                        <div class="col-sm-8">
                            <br>
                            <h3>Description</h3>
                            <p>
                                <textarea id="body" name="body">{{ event.description }}</textarea>
                                <br>
                            </p>
                            <input type="text" id="event_id" name="event_id" value="{{ event.id }}" hidden/>
                        </div>

                        <div class="col-sm-4">
                            <div class="row">
                                <br>
                                <div class="event-details-sidebar">
                                    <h3>Event Details</h3>
                                    <div class="form-group">
                                        <label for="event-name">Title</label>
                                        <input type="text" id="event-name" name="title" class="form-control"
                                               value="{{ event.title }}" placeholder="Some event">
                                    </div>

                                    <div class="form-group">
                                        <label for="startdatetime">Start date & time</label>
                                        <input type="text" id="startdatetime" class="form-control" value="{{ event.start_date |date:"Y-m-d H:i" }}"
                                               name="startdatetime"/>

                                    </div>
                                    <div class="form-group">
                                        <label for="enddatetime">End date & time</label>
                                        <input type="text" id="enddatetime" class="form-control" value="{{ event.pub_date|date:"Y-m-d H:i"}}" name="enddatetime"/>

                                    </div>
                                    <div class="form-group">
                                        <label for="event-url">Event URL</label>
                                        <input type="text" id="event-url" class="form-control" name="event-url"
                                               value="{{ event.event_url }}">
                                    </div>

                                    <br>
                                    <br>
                                    <button class="btn btn-transparent-dark" type="submit">Save</button>
                                    {% if next %}
                                        <a class="btn btn-transparent-dark" type="button" href="{{ next }}/events">Cancel</a>
                                    {% else %}
                                        <a class="btn btn-transparent-dark" type="button" href="/events/">Cancel</a>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

            </div><!-- /.container -->

        </section>
    </div><!-- /#main -->

{% endblock %}

{% block customscript %}

    <script>
    $(document).ready(function () {
         $("#startdatetime").datetimepicker({
                format: 'yyyy-mm-dd hh:ii',
                autoclose: true,
                todayBtn: true
            });

            $("#enddatetime").datetimepicker({
                format: 'yyyy-mm-dd hh:ii',
                autoclose: true,
                todayBtn: true
            });

    })
    </script>
{% endblock %}
