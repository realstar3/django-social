{% extends 'events/base.html' %}
{% block content %}

    {% load staticfiles %}
    <style>
        img.resize {
            max-width: 50%;
            max-height: 50%;
        }
    </style>
    <header id="masthead" class="site-header event-list-header">

        <div class="top-nav">

            <div class="container container-960">
                <a href="index.html" class="site-logo" rel="home"><img src="{% static 'events/img/logo.png' %}" alt=""
                                                                       srcset="{% static 'events/img/logo.png' %} 1x, {% static 'events/img/logo@2x.png' %} 2x"></a>

                <button class="lines-button x toggle-menu" type="button" id="toggle-menu">
                    <span class="lines line-top"></span>
                    <span class="lines line-middle"></span>
                    <span class="lines line-bottom"></span>
                </button><!-- /.lines-button -->

                <nav id="primary-navigation" class="site-navigation">

                    <a href="index.html" class="site-logo visible-xs" rel="home"><img
                            src="{% static 'events/img/logo.png' %}" alt=""
                            srcset="{% static 'events/img/logo.png' %} 1x, {% static 'events/img/logo@2x.png' %} 2x"></a>

                    <ul>
                        <li><a href="/news">News</a></li>
                        <li class="active"><a href="/events">Events</a></li>
                        <li><a href="#">Startups</a></li>
                        <li><a href="#">Jobs</a></li>
                        <li><a href="#">Companies</a></li>
                    </ul>

                </nav><!-- /.site-navigation -->

                <div class="user-profile dropdown">
                    <a class="dropdown-toggle" id="user-dropdown-menu" data-toggle="dropdown" aria-expanded="true">
                        <div class="user-profile-thumb"><img src="{% static 'officespace/img/avatar.jpg' %}" alt="">
                            <span
                                    class="visible-xs caret"></span></div>
                        <div class="user-profile-meta hidden-xs">
                            <div class="user-profile-meta-inner">
                                {{ request.user.username }}
                            </div>
                        </div>
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="user-dropdown-menu">
                        <li><a href="person-profile.html">Profile</a></li>
                        <li><a href="#">Settings</a></li>
                        <li class="logout-btn"><a href="/logout">Logout</a></li>
                    </ul>
                </div><!-- /.user-profile -->

            </div><!-- /.container -->

        </div><!-- /.top-nav -->

    </header><!-- /#header -->
    <div id="main" class="site-main">

        <section class="events-info">

            <div class="container">

                <div class="row">

                    <div class="col-sm-6">
                        <div class="events-info-inner">
                            <h2>Events</h2>
                            <p>{{ event_count }} events,<br>
                                {{ user_all }} members,<br>
                                365 days a year</p>

                            <p>Share or attend events here.</p>
                        </div><!-- /.events-info-inner -->
                    </div>

                    <div class="col-sm-6">
                        <form class="event-form">
                            <div class="form-group mb-30">
                                <label for="find-event">Find an event</label>
                                <input type="text" id="find-event" class="form-control"
                                       placeholder="Beginnerâ€™s Code Group" onkeyup="realFilter()">
                            </div>
                            <div class="form-group">
                                <button class="btn btn-dark" type="button" >Search YFB events</button>
                                <button class="btn btn-transparent-dark" type="button" data-toggle="modal"
                                        data-target="#create-event-modal">Create new event
                                </button>
                            </div>
                        </form><!-- /.event-form -->
                    </div>
                </div>
            </div>
        </section><!-- /.events-info -->

        <section class="next-events">

            <div class="container container-960">

                <div class="row">
                    <div class="col-sm-6">
                        <p class="news-category">11am 8 Aug 2017</p>
                        <h2 class="news-title">Fintech Australia:<br> R&amp;D Tech Grants 101 Workshop</h2>
                        <p class="news-description"><span class="posted-by">posted by<br> <a href="#">Xero</a></span> <a
                                href="#" class="rsvp-btn">RSVP</a></p>
                    </div>

                    <div class="col-sm-6">
                        <p class="news-category">11am 8 Aug 2017</p>
                        <h2 class="news-title">DisruptHealth: A Primer for Entrepenuers, Professionals and
                            Patients.</h2>
                        <p class="news-description"><span class="posted-by">posted by<br> <a href="#">BlockChain AU</a></span>
                            <a href="#" class="rsvp-btn">RSVP</a></p>
                    </div>
                </div>
            </div><!-- /.container -->
        </section><!-- /.next-events -->

        <section class="events-list">
            <div class="container container-960">
                <div class="filters-fix">
                    <div class="filters-wrapper">
                        <div class="events-filter  news-filter">
                            <ul class="list-unstyled">
                                <li><a id="search" href="javascript:void(0)">Search</a></li>
                                <li><a href="javascript:newEvent();">New</a></li>
                                <li><a href="javascript:featuredEvent();">Featured</a></li>
                            </ul>
                            <a href="javascript:allEvent();" class="all-events pull-right">All Events...</a>
                        </div><!-- /.events-filter -->

                        <div class="events-filter">
                            <div id="search-form" class="row" style="display: none; padding-left: 7%">
                                <input id="searchBar" class="form-control" type="text"
                                       placeholder="keyword..."
                                       style="width: 100%;" onkeyup="realFilter()"/>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="event_items">
                    {% if event_all %}

                        {% regroup event_all by start_date|date:"Y-m-d" as events_by_day %}

                        {% for day in events_by_day %}
                            <div class="row row-margin-1" id="{{ day.list.0.start_date|date:"Y-m-j" }}"
                                 style="display: none;">
                                <div class="col-sm-12 col-xs-12">
                                    <p class="events-date">{{ day.list.0.start_date|date:"l\, F j" }}</p>
                                </div>
                                {% for event in day.list %}
                                    <div class="col-sm-3 col-xs-12">
                                        <div class="event-item">
                                            <p class="event-date">{{ event.start_date|date:"fA j N Y" }}</p>
                                            <h2 class="event-name"><a href="{{ event.id }}">{{ event.title }}</a></h2>
                                            <a href="{{ event.id }}" class="event-attending">posted
                                                by {{ request.user.username }}</a>
                                        </div><!-- /.event-item -->
                                    </div>
                                {% endfor %}

                            </div><!-- /.row -->
                        {% endfor %}

                    {% endif %}

                    <p id="weekNone" style="display: none;">Nothing this week!</p>

                </div>
                <nav id="weekEvent" aria-label="Events list navigation" style="display: block;">
                    <ul class="pagination">
                        <li class="text-pagination">
                            <a href="javascript:previous_week();" aria-label="Previous">
                                <span aria-hidden="true">&larr; Prev Week</span>
                            </a>
                        </li>
                        <li class="text-pagination">
                            <a href="javascript:next_week();" aria-label="Next">
                                <span aria-hidden="true">Next Week &rarr;</span>
                            </a>
                        </li>
                    </ul>

                </nav>
                <nav id="allEvent" class="pagination-page pull-right" aria-label="News list navigation"
                     style="padding-top: 10px; display: none;">
                </nav>
            </div><!-- /.container-fluid -->
        </section><!-- /.events-list -->

    </div><!-- /#main -->

    <div id="create-event-modal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document" style="width: 80%; padding-left: 20%">
            <div class="modal-content" style="width: 60%;">

                <div class="modal-body">

                    <div class="modal-body-left" style="width: 100%">

                        <h4 class="modal-title">Add Event</h4>
                        <form class="create-event-form" method="post" action="create/"
                              enctype="multipart/form-data">{% csrf_token %}
                            <div class="form-group">
                                <label for="event-name">Title</label>
                                <input type="text" id="event-name" name="title" class="form-control"
                                       placeholder="Some event">
                            </div>
                            <div class="form-group">
                                <label for="startdatetime">Start date & time</label>
                                <input type="text" class="form-control" name="startdatetime" id="startdatetime"/>

                            </div>
                            <div class="form-group">
                                <label for="enddatetime">End date & time</label>
                                <input type="text" id="enddatetime" class="form-control" name="enddatetime"/>

                            </div>
                            <div class="form-group">
                                <label for="event-url">Event URL</label>
                                <input type="text" id="event-url" class="form-control" name="event-url"
                                       placeholder="https://meetup.com/event/21312312321">
                            </div>

                            <div class="modal-form-buttons">
                                <a data-dismiss="modal" class="pull-left close-btn hidden-xs" href="#">Close</a>
                                <button class="btn btn-dark pull-right" type="submit">Add Event</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /#create-event-modal -->

{% endblock %}

{% block customscript %}
    <script type="text/javascript" src="{% static "events/js/eventsscript.js" %}"></script>
    <script>
        var AllItemElements;  // save all Item Elements.
        var currentDay;
        var regroupElement = {};  // regroup all elements by week
        var newElements;   // group new element only.
        var weekCount = 0;  // calculate weekcount.

        $(document).ready(function () {
            AllItemElements = $("#event_items .row-margin-1");

            // visible or invisible search box.
            $('#search').click(function () {
                if ($("#search-form").is(':visible')) {
                    $("#search-form").fadeOut();
                } else {
                    $("#search-form").fadeIn();
                }
            });

            $(document.body).click(function (e) {
                //Hide the search bar if visible
                if (e.target.id !== "searchBar" && e.target.id !== "search")
                    $("#search-form").hide();
            });

            $("#startdatetime").datetimepicker({
                format: 'yyyy-mm-dd hh:ii',
                autoclose: true,
                todayBtn: true
            });

            $("#enddatetime").datetimepicker({
                format: 'yyyy-mm-dd hh:ii',
                autoclose: true,
                todayBtn: true
            });
            currentDay = "{{ current_day }}";

            Regroup(currentDay, AllItemElements);
            showElements();
        });
    </script>
{% endblock %}